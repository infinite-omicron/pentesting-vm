build {
  name        = "pentesting-vagrant"
  description = "Penetration Testing Virtual Machine"

  sources = [
    "source.vagrant.alpine"
  ]

  provisioner "shell" {
    environment_vars = ["GOPATH=$HOME/go","PIP_ROOT_USER_ACTION=ignore"]
    scripts = [
      "scripts/dependencies.sh",
      "scripts/apktool.sh",
      "scripts/dex2jar.sh",
      "scripts/jd_cmd.sh",
      "scripts/theharvester.sh",
      "scripts/zaproxy.sh",
      "scripts/firefox.sh"
    ]
    execute_command = "echo 'vagrant' | sudo -S -E sh -c '{{ .Vars }} {{ .Path }}'"
  }
  
  provisioner "file" {
    source = "upload/go.sh"
    destination = "/tmp/go.sh"
  }
  provisioner "shell" {
    inline = [
    "sudo mv /tmp/go.sh /etc/profile.d/"]
  }
}

build {
  name        = "pentesting-docker"
  description = "Penetration Testing Virtual Machine"

  sources = [
    "source.docker.alpine"
  ]
  
  post-processor "docker-tag" {
  repository = "ghcr.io/infinite-omicron/pentesting:latest"
}

  provisioner "shell" {
    environment_vars = ["PIP_ROOT_USER_ACTION=ignore","GOPATH=/go"]
    scripts = [
      "scripts/dependencies.sh",
      "scripts/apktool.sh",
      "scripts/dex2jar.sh",
      "scripts/jd_cmd.sh",
      "scripts/theharvester.sh",
      "scripts/zaproxy.sh",
      "scripts/firefox.sh"
    ]
  }
  
  provisioner "file" {
    source = "upload/go.sh"
    destination = "/go.sh"
  }
  provisioner "shell" {
    inline = [
    "sudo mv /go.sh /etc/profile.d/"]
  }
  
  provisioner "shell" {
    /* Fix permissions */
    inline = ["chown -R root:root /opt"]
  }
}
