variable "name" {
  type    = string
  default = "pentesting"
}

variable "description" {
  type    = string
  default = "Penetration Testing Virtual Machine"
}

variable "scripts" {
  default = [
    "scripts/dependencies.sh",
    "scripts/apktool.sh",
    "scripts/dex2jar.sh",
    "scripts/gobuster.sh",
    "scripts/jd_cmd.sh",
    # "scripts/mobsf.sh",
    "scripts/theharvester.sh",
    "scripts/zaproxy.sh"
  ]
}

build {
  name        = "${var.name}-vagrant"
  description = var.description

  sources = [
    "source.vagrant.alpine"
  ]

  provisioner "shell" {
    scripts         = var.scripts
    execute_command = "echo 'vagrant' | sudo -S -E sh -c '{{ .Vars }} {{ .Path }}'"
  }
}

build {
  name        = "${var.name}-docker"
  description = var.description

  sources = [
    "source.docker.alpine"
  ]

  provisioner "shell" {
    environment_vars = ["PIP_ROOT_USER_ACTION=ignore"]
    scripts          = var.scripts
  }

  provisioner "shell" {
    /* Fix permissions */
    inline = ["chown -R root:root /opt"]
  }

  post-processor "docker-tag" {
    repository = "ghcr.io/infinite-omicron/pentesting:latest"
  }
}

