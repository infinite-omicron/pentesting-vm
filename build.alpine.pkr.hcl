build {
  name        = "pentesting-vagrant"
  description = "Penetration Testing Virtual Machine"

  sources = [
    "source.vagrant.alpine"
  ]

  provisioner "shell" {
    scripts = [
      "scripts/dependencies.sh",
      "scripts/apktool.sh",
      "scripts/dex2jar.sh",
      "scripts/jd_cmd.sh",
      "scripts/theharvester.sh",
      "scripts/zaproxy.sh"
    ]
    execute_command = "echo 'vagrant' | sudo -S -E sh -c '{{ .Vars }} {{ .Path }}'"
  }
}

build {
  name        = "pentesting-docker"
  description = "Penetration Testing Virtual Machine"

  sources = [
    "source.docker.alpine"
  ]

  provisioner "shell" {
    scripts = [
      "scripts/dependencies.sh",
      "scripts/apktool.sh",
      "scripts/dex2jar.sh",
      "scripts/jd_cmd.sh",
      "scripts/theharvester.sh",
      "scripts/zaproxy.sh"
    ]
    execute_command = "echo 'vagrant' | sudo -S -E sh -c '{{ .Vars }} {{ .Path }}'"
  }

  provisioner "shell" {
    /* Fix permissions */
    inline = ["chown -R root:root /opt"]
  }
}

build {
  name        = "pentesting-docker"
  description = "Penetration Testing Virtual Machine"

  sources = [
    "source.docker.alpine"
  ]

  post-processor "docker-tag" {
    repository = "ghcr.io/infinite-omicron/pentesting:latest"
  }

  provisioner "shell" {
    scripts = [
      "scripts/dependencies.sh",
      "scripts/apktool.sh",
      "scripts/dex2jar.sh",
      "scripts/jd_cmd.sh",
      "scripts/mobsf.sh",
      "scripts/theharvester.sh",
      "scripts/zaproxy.sh"
    ]
  }

  provisioner "shell" {
    /* Fix permissions */
    inline = ["chown -R root:root /opt"]
  }
}
