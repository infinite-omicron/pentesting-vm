Vagrant.configure("2") do |config|
  config.vm.box = "generic/alpine312"

  config.vm.provider "virtualbox" do |vb|
    vb.name = "pentesting-vm"
    vb.gui = true
  end

  config.ssh.forward_agent = true
  config.ssh.forward_x11 = true

  config.vm.provision "shell", inline: <<-SHELL
    apk update && \
    apk add \
      bzip2 \
      curl \
      g++ \
      gcc \
      go \
      git \
      libffi-dev \
      libxml2-dev \
      libxslt-dev \
      make \
      nikto \
      nmap \
      openssl-dev \
      python3-dev \
      py3-pip \
      tar
    go get github.com/OJ/gobuster
    python3 -m pip install --upgrade pip && \
    pip install mitmproxy sqlmap sslyze

    # MobSF
    git clone https://github.com/mobsf/mobile-security-framework-mobsf /opt/mobsf
    cd /opt/mobsf && \
      ./setup.sh && \
      ln -s /opt/mobsf/run.sh /usr/local/bin/mobsf

    # theHarvester
    git clone https://github.com/laramies/theharvester /opt/theharvester
    cd /opt/theharvester && \
      python3 -m pip install -r requirements/base.txt && \
      ln -s /opt/theharvester/theHarvester.py /usr/local/bin/theHarvester

    # OWASP ZAP
    cd /opt && \
      curl -LO https://github.com/zaproxy/zaproxy/releases/download/v2.9.0/ZAP_2.9.0_Linux.tar.gz && \
      tar -xf ZAP_2.9.0_Linux.tar.gz && \
      mv ZAP_2.9.0 zap && \
      rm -rf ZAP_2.9.0_Linux.tar.gz && \
      ln -s /opt/zap/zap.sh /usr/local/bin/zap
  SHELL

end
