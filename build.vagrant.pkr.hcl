local "vagrant_execute_command" {
  expression = "echo 'vagrant' | sudo -S -E sh -c '{{ .Vars }} {{ .Path }}'"
}

build {
  name        = "${local.name}-vagrant"
  description = local.description

  sources = [
    "source.vagrant.alpine"
  ]

  provisioner "shell" {
    scripts         = local.tools
    execute_command = local.vagrant_execute_command
  }

  provisioner "shell" {
    script          = "scripts/firefox.sh"
    execute_command = local.vagrant_execute_command
  }

  provisioner "goss" {
    arch      = "amd64"
    target_os = "Linux"
    inspect   = true
    tests     = "goss.yaml"
    use_sudo  = true
  }
}

